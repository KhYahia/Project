<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FreshChain ‚Äì Product Traceability</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    pre { background: #fafafa; padding: 14px; border-radius: 10px; }
  </style>
</head>
<body>

<h2>üì¶ FreshChain ‚Äì Blockchain Product Traceability</h2>

<pre id="history">Loading history...</pre>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
const CONTRACT_ADDRESS = "0x92F8eFCB1cd479eE2c7FE9AaDAFEe6248B09e88F";

const ABI = [{
  "inputs":[{"internalType":"uint256","name":"batchId","type":"uint256"}],
  "name":"getBatchHistory",
  "outputs":[{
    "components":[
      {"internalType":"uint256","name":"batchId","type":"uint256"},
      {"internalType":"string","name":"productName","type":"string"},
      {"internalType":"uint256","name":"quantity","type":"uint256"},
      {"internalType":"address","name":"currentOwner","type":"address"},
      {"internalType":"bool","name":"arrived","type":"bool"},
      {"internalType":"bool","name":"inspectionPassed","type":"bool"},
      {"components":[
        {"internalType":"int256","name":"temperature","type":"int256"},
        {"internalType":"int256","name":"humidity","type":"int256"},
        {"internalType":"string","name":"location","type":"string"},
        {"internalType":"uint256","name":"timestamp","type":"uint256"},
        {"internalType":"address","name":"transporter","type":"address"}
      ],"internalType":"struct FreshChain.SensorData[]","name":"sensors","type":"tuple[]"},
      {"components":[
        {"internalType":"address","name":"from","type":"address"},
        {"internalType":"address","name":"to","type":"address"},
        {"internalType":"uint256","name":"timestamp","type":"uint256"}
      ],"internalType":"struct FreshChain.Ownership[]","name":"ownerships","type":"tuple[]"},
      {"internalType":"bool","name":"exists","type":"bool"}
    ],
    "internalType":"struct FreshChain.Batch",
    "name":"",
    "type":"tuple"
  }],
  "stateMutability":"view",
  "type":"function"
}];

const provider = new ethers.providers.JsonRpcProvider(
  "https://sepolia.infura.io/v3/YOUR_INFURA_KEY"
);

const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

function getParam(n) {
  return new URLSearchParams(window.location.search).get(n);
}

function time(ts) {
  return new Date(Number(ts) * 1000).toLocaleString();
}

(async () => {
  const id = getParam("batchId");
  if (!id) return history.textContent = "‚ùå No batch ID provided.";

  const b = await contract.getBatchHistory(id);
  if (!b.exists) return history.textContent = "‚ùå Batch not found.";

  let txt = `
Batch ID: ${b.batchId}
Product: ${b.productName}
Quantity: ${b.quantity}
Owner: ${b.currentOwner}
Arrived: ${b.arrived}
Inspection Passed: ${b.inspectionPassed}
