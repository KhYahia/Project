<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FreshChain – Management Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    body { font-family: system-ui, Arial; margin: 24px; }
    .card { border: 1px solid #ddd; padding: 16px; border-radius: 10px; margin-bottom: 20px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 8px; }
    input, button { padding: 8px; font-size: 14px; }
    pre { background: #fafafa; padding: 12px; border-radius: 8px; }
  </style>
</head>
<body>

<h2>FreshChain – Management Panel</h2>

<div class="card">
  <button id="connectBtn">Connect MetaMask</button><br><br>
  <b>Account:</b> <span id="account">-</span><br>
  <b>Network:</b> Sepolia
</div>

<div class="card">
  <h3>Customer – View History</h3>
  <div class="row">
    <input id="viewId" placeholder="Batch ID">
    <button id="viewBtn">View History</button>
  </div>
  <pre id="out">History will appear here…</pre>
</div>

<div class="card">
  <h3>QR Code</h3>
  <div class="row">
    <input id="qrId" placeholder="Batch ID">
    <button id="qrBtn">Generate QR</button>
  </div>
  <canvas id="qrCanvas"></canvas>
  <p id="qrLink"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

<script>
const CONTRACT_ADDRESS = "0x92F8eFCB1cd479eE2c7FE9AaDAFEe6248B09e88F";

const ABI = [{
  "inputs":[{"internalType":"uint256","name":"batchId","type":"uint256"}],
  "name":"getBatchHistory",
  "outputs":[{
    "components":[
      {"internalType":"uint256","name":"batchId","type":"uint256"},
      {"internalType":"string","name":"productName","type":"string"},
      {"internalType":"uint256","name":"quantity","type":"uint256"},
      {"internalType":"address","name":"currentOwner","type":"address"},
      {"internalType":"bool","name":"arrived","type":"bool"},
      {"internalType":"bool","name":"inspectionPassed","type":"bool"},
      {"components":[
        {"internalType":"int256","name":"temperature","type":"int256"},
        {"internalType":"int256","name":"humidity","type":"int256"},
        {"internalType":"string","name":"location","type":"string"},
        {"internalType":"uint256","name":"timestamp","type":"uint256"},
        {"internalType":"address","name":"transporter","type":"address"}
      ],"internalType":"struct FreshChain.SensorData[]","name":"sensors","type":"tuple[]"},
      {"components":[
        {"internalType":"address","name":"from","type":"address"},
        {"internalType":"address","name":"to","type":"address"},
        {"internalType":"uint256","name":"timestamp","type":"uint256"}
      ],"internalType":"struct FreshChain.Ownership[]","name":"ownerships","type":"tuple[]"},
      {"internalType":"bool","name":"exists","type":"bool"}
    ],
    "internalType":"struct FreshChain.Batch",
    "name":"",
    "type":"tuple"
  }],
  "stateMu


